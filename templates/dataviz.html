<div class="dataviz">

<!-- if the motion gets too annoying: a freeze button -->
<!-- currently does nothing lol -->
<div style="float: right;"> <input type='button' value='Freeze'> </div>

<script>

// toy data
var pages = ['Ishmael', 'Flask', 'Stubb', 'Starbuck']

// tooltip element
var titlediv = d3.select('body').append('div')   
    .attr("class", "tooltip")               
    .style("opacity", 0);

// create SVG element
var parent = d3.select('.dataviz').append('svg')
	.attr('width', (window.innerWidth * 0.29))
	.attr('height', (window.innerHeight * 0.95));

var child = parent.selectAll('svg')
	.data(pages)
	.enter().append('g')	// will hold both circle and text
	.attr('id', function(d, i) {
		return 'g' + i;
	});


var cir = child.append('circle')
	.attr('cx', function(s, i) { return xvals(i); })
	.attr('cy', function(s, i) { return xvals(i); })
	.attr('r', 10)
	.attr('class', 'circle')
	.attr('fill', function(s, i) {
		var colors=['red', 'orange', 'lightgreen', 'lightblue'];
		return colors[i];
	})
	.attr('stroke', 'black');

var caption = child.append('text')
	.attr('x', function(d, i) {
		//var c_loc = d3.mouse(d3.select(this.parentNode).select('.circle'));
		//console.log(c_loc);
		return xvals(i); 
	})
	.attr('y', function(d, i) { return xvals(i); })
	.attr('dy', '.35em')
	.attr('class', 'caption')
	.style('opacity', 0)
	.text(function(d) {return d; });

var cir_each = d3.selectAll('g').selectAll('text');

cir.on('mouseover', function(d) {
	var xplace = d3.select(this).attr('cx');
	var yplace = d3.select(this).attr('cy');
	d3.select(this)
		.transition()
			.duration(500)
			.attr('fill', 'white')
			.attr('stroke', 'black');
	d3.select(this.parentNode).select('.caption')
		// first move the text close to the cursor (and the node)
		.attr('x', function(d) {
			var xplace2 = parseInt(xplace) + 20;
			return xplace2;
		})
		.attr('y', function(d) { return yplace; })
		// now change the opacity
		.transition()
			.duration(200)
			.style('opacity', .8)
			.text(d);
 });

cir.on('mouseout', function(d, i) {
	d3.select(this).transition()
		.duration(500)
		.attr('fill', function(d) {
			var colors=['#377BA8', '#377BA8', '#377BA8', '#377BA8'];
			return colors[i];
		})
		.attr('stroke', 'gray');
	caption.transition()
		.duration(500)
		.style('opacity', 0);
});


function xvals(i) {
	var x = [10, 30, 60, 100];
	return x[i];
}

// random x, y value for circle destination
function getRandomInt (min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

var rand_y = getRandomInt(0, (window.innerHeight * 0.95));
var rand_x = getRandomInt(0, (window.innerWidth * 0.29));

var line = d3.svg.line()
	.x(function(d) {return d.x; })
	.y(function(d) {return d.y; })
	.interpolate('basis');

d3.selectAll('circle').transition()
	.ease('linear')
	.attr('cy', function() {
		return getRandomInt(0, (window.innerHeight * 0.95));
	})
	.attr('cx', function() {
		return getRandomInt(0, (window.innerWidth * 0.29));
	})
	.duration(4000);


// Adjust SVG width and height every time window is resized
window.addEventListener('resize', adjustSVG);
function adjustSVG() {
	var new_w = window.innerWidth * 0.29;
	var new_h = window.innerHeight * 0.95;
	parent.attr('width', new_w)
		.attr('height', new_h);
}

</script>

</div>